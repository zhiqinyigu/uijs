<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<head>
</head>
<body>
<style type="text/css">
*{margin:0;padding:0;}
body{margin:8px;}
.jsonTree{font-family:Tahoma,Georgia;font-size:14px;margin:20px 40px;position:relative;}
.jsonTree .filter{position:absolute;left:0;margin:3px 0 0 10px;}
.jsonTree .name{color:#C00;font-weight:bold;}
.jsonTree .object{color:#0A0;font-weight:bold;}
.jsonTree .array{color:#03F;font-weight:bold;}
.jsonTree .string{color:#077;}
.jsonTree .number{color:#A0A;}
.jsonTree li{list-style:none;position:relative;}
.jsonTree li li{padding:0 0 0 30px;}
</style>
<textarea id="json" style="width:500px;height:40px;">{"result":0,"msg":"\u6210\u529f","data":{"message":{"id":"54794117623478","content":"\u3010\u5341\u4e8c\u661f\u5ea7\u56e0\u4e3a\u4ec0\u4e48\u800c\u5206\u624b\u3011\u767d\u7f8a\u5ea7\uff08\u76f4\u7387\u706b\u66b4\uff09\u3001\u91d1\u725b\u5ea7\uff08\u5fcd\u65e0\u53ef\u5fcd\uff09\u3001\u53cc\u5b50\u5ea7\uff08\u70ed\u5ea6\u9000\u53bb\uff09\u3001\u5de8\u87f9\u5ea7\uff08\u654f\u611f\u4e0d\u5b89\uff09\u3001\u72ee\u5b50\u5ea7\uff08\u6ca1\u8010\u6027\uff09\u3001\u5904\u5973\u5ea7\uff08\u65e0\u6127\u81ea\u5df1\uff09\u3001\u5929\u79e4\u5ea7\uff08\u7f3a\u4e4f\u6d6a\u6f2b\uff09\u3001\u5929\u874e\u5ea7\uff08\u5bf9\u65b9\u4e0d\u73cd\u60dc\uff09\u3001\u5c04\u624b\u5ea7\uff08\u81ea\u5a31\u81ea\u4e50\uff09\u3001\u9b54\u7faf\u5ea7\uff08\u65e0\u6cd5\u4e86\u89e3\uff09\u3001\u6c34\u74f6\u5ea7\uff08\u65e0\u6cd5\u6ee1\u8db3\uff09\u3001\u53cc\u9c7c\u5ea7(\u4e0d\u73b0\u5b9e)\u3002","time":1337072363,"status":0,"from":1021293,"contentType":133,"type":1,"uin":345449540,"srcId":null,"image":["http:\/\/t3.qpic.cn\/mblogpic\/bdacd28220e0a4a168a8"],"imageInfo":{"http:\/\/t3.qpic.cn\/mblogpic\/bdacd28220e0a4a168a8":{"size":33636,"width":440,"high":440,"XDPI":96,"YDPI":96,"numColors":256,"type":2,"flag":0}},"videos":[],"music":[],"mlist":[],"file":[],"vote":[],"gps":[],"count":{"rt":40580,"comment":15100},"campus":[],"signCheckin":[],"rich":[],"feed":[],"act":[],"location":{"nation":"1","province":"21","city":"14"},"rtCount":55680,"tran":0},"sourceMessage":[],"count":0,"pageFlage":2,"relayMessageArray":[],"emptyUins":[],"pageInfo":{"hidden":false,"prev":{"pf":0,"time":1337141573,"id":"98762108679483","p":2},"1":{"pf":0,"time":0,"id":"0","p":1},"2":{"pf":0,"time":1337141573,"id":"98762108679483","p":2},"3":{"currentFlag":true}},"countArray":{"1":{"count":40580},"2":{"count":15100},"5":{"count":10},"6":{"count":3}},"users":{"345449540":{"name":"taobao988","nick":"\u5fae\u60c5\u611f","url":"http:\/\/t0.qlogo.cn\/mbloghead\/928a39ab448daf9e0e66","account":{"name":"taobao988","nick":"\u5fae\u60c5\u611f","flag":{"govAuthIcon":true,"govCert":true,"passCert":true},"vip":0,"vivi":"","uin":345449540},"mini":{"url":"http:\/\/t0.qlogo.cn\/mbloghead\/928a39ab448daf9e0e66"},"attrs":{"weikongjian":false},"bkname":null}},"ownerUser":{"name":"taobao988","nick":"\u5fae\u60c5\u611f","url":"http:\/\/t0.qlogo.cn\/mbloghead\/928a39ab448daf9e0e66","account":{"name":"taobao988","nick":"\u5fae\u60c5\u611f","flag":{"govAuthIcon":true,"govCert":true,"passCert":true},"vip":0,"vivi":"","uin":345449540},"mini":{"url":"http:\/\/t0.qlogo.cn\/mbloghead\/928a39ab448daf9e0e66"},"attrs":{"weikongjian":false},"bkname":null},"accountMap":[],"relayers":[],"qinfos":[],"rootId":"54794117623478"}}</textarea>
<button onclick="jsonTree.show($('#json')[0].value)">格式化</button>
<button onclick="$('#json')[0].value=jsonTree.getJson()">获取新json</button>
<div class="jsonTree"><ul><li id="jsonTreeWrap"></li></ul></div>
<script src="http://www.qq.com/mb/mat1/mb/js/api/jquery.js"></script>
<script type="text/javascript">
/*
 *Json树
*/
function JsonTree(obj){
    var Self = this;
    Self._body = obj.target;
    Self.data = obj.data;
}
JsonTree.prototype = {
    _body : null,
    data : null, //原始数据
    edit : true, //是否可以编辑json值
    filter : true, //是否可以过滤json项
    show : function(json){ //创建树
        var Self = this;
        try{
            Self.data = (typeof json == 'string' ? eval('(' + json + ')') : json);
        }catch(e){
            Self.data = '';
        }
        Self._body.innerHTML = parseData(Self.data).replace(/<\/li>,/g,',</li>');
        Self.addEvent();
        function parseData(data){
            var dataType = Self.getType(data),
                string = [],
                isArray = dataType == 'Array';
            if (typeof data == 'object') {
                if (data === null) {
                    return '<span class="array">' + 'null' + '</span>';
                }
                for (var i in data) {
                    //console.log(i);
                    //string.push((isArray ? '<input type="checkbox" checked class="filter">' : ('<li><input type="checkbox" checked class="filter"><span class="name">"' + i + '"</span>:')) + parseData(data[i]) + '</li>');
                    string.push((isArray ? '' : ('<li><input type="checkbox" checked class="filter"><span class="name">"' + i + '"</span>:')) + parseData(data[i]) + '</li>');
                }
                if(string.length) {
                    string = '<ul><li>' + string.join(',</li><li>') + '</li></ul>';
                }
                else {
                    string = '';
                }
                //console.log(string);
                return isArray ? ('<span class="array">[</span>' + string + '<span class="array objectEnd">]</span>') : ('<span class="object">{</span>' + string + '<span class="object objectEnd">}</span>');
            } else if (dataType == 'Number' || dataType == 'Function') {
                return '<span class="number">' + data.toString() + '</span>';
            } else if (dataType == 'Undefined') {
                return '<span class="array">' + 'undefined' + '</span>';
            }
            return '<span class="string">' + (!data ? '""' : ('"' + data.toString().replace(/"/g,'\\"').replace(/</g,'&lt;').replace(/>/g,'&gt;') + '"')) + '</span>';
        }
    },
    addEvent : function(){
        var Self = this;
        $('.filter',Self._body).click(function(){
            //console.log(this.checked);
            if (this.checked){
                $('ul',this.parentNode).eq(0).show();
            }
            else {
                $('ul',this.parentNode).eq(0).hide();
            }
        });
    },
    getJson : function(){ //获取Json
        var Self = this,
            clone = Self._body.cloneNode(1);
        $('.filter',clone).each(function(i,o){
            if (!o.checked) $(o).parent().remove();
        });
        $('.objectEnd',clone).each(function(i,o){
            var last = $('li:last',$(o).prev()).prev();
            //if (last.length)
            //last.get(0).innerHTML = last.text().replace(/,$/g,'');
        });
        //console.log(clone);
        return $(clone).text();
    },
    getType : function(o){ //获取变量类型
        return Object.prototype.toString.call(o).slice(8,-1);
    }
}

//生成实例
var jsonTree = new JsonTree({
    target : $('#jsonTreeWrap')[0]
});
jsonTree.show($('#json')[0].value);
//console.log(jsonTree);
</script>
</body>
</html>