<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<head>
</head>
<body>
<style type="text/css">
*{margin:0;padding:0;}
body{margin:8px;}
.jsonTree{font-family:Tahoma,Georgia;margin:20px 40px;position:relative;}
.jsonTree .filter{position:absolute;left:0;margin:5px 0 0 10px;}
.jsonTree .name{color:#C00;font-weight:bold;}
.jsonTree .object{color:#0A0;font-weight:bold;}
.jsonTree .array{color:#03F;font-weight:bold;}
.jsonTree .string{color:#077;}
.jsonTree .number{color:#A0A;}
.jsonTree li{list-style:none;position:relative;}
.jsonTree li li{padding:0 0 0 30px;}
</style>
<textarea id="json" style="width:500px;height:40px;">{result:0,msg:'成功','info':{'user':'xhlv','hasNext':1,'time':1333376049,'talk':[{"id":"102692067233600","content":"\u3010\u4e3a\u4e86\u5fd8\u8bb0\u7684\u8bb0\u5fc6\u3011\u5fd8\u8bb0\u4e00\u4e2a\u4eba\uff0c\u5e76\u975e\u4e0d\u518d\u60f3\u8d77\uff0c\u800c\u662f\u5076\u5c14\u60f3\u8d77\uff0c\u5fc3\u4e2d\u5374\u4e0d\u518d\u6709\u6ce2\u6f9c\u3002\u771f\u6b63\u7684\u5fd8\u8bb0\uff0c\u662f\u4e0d\u9700\u8981\u52aa\u529b\u7684\u3002 \u6bcf\u4e2a\u4eba\u7684\u7535\u8bdd\u672c\u91cc\uff0c\u90fd\u4f1a\u6709\u90a3\u4e48\u4e00\u4e2a\u4f60\u6c38\u8fdc\u4e0d\u4f1a\u6253\uff0c\u4e5f\u6c38\u8fdc\u4e0d\u4f1a\u5220\u7684\u53f7\u7801\uff1b\u6bcf\u4e2a\u4eba\u7684\u5fc3\u91cc\uff0c\u90fd\u4f1a\u6709\u90a3\u4e48\u4e00\u4e2a\u4f60\u6c38\u8fdc\u4e0d\u4f1a\u63d0\uff0c\u4e5f\u6c38\u8fdc\u4e0d\u4f1a\u5fd8\u7684\u4eba\u2764\u559c\u6b22\u8bf7\u6536\u542c\u2192@<em rel=\"@mrnnnn\"><a href=\"http:\/\/t.qq.com\/mrnnnn\" title=\"\u5fc3\u60c5\u7b7e\u540d\u96c6(@mrnnnn)\">\u5fc3\u60c5\u7b7e\u540d\u96c6<\/a><\/em>","sign":"","signSubType":0,"image":["http:\/\/t3.qpic.cn\/mblogpic\/743d43f025aaaa27c116"],"time":"\u521a\u521a","type":1,"status":0,"from":"<a href=\"http:\/\/t.pp.cc\/\" class=\"f\" target=\"_blank\">\u6765\u81ea\u76ae\u76ae\u7cbe\u7075<\/a>","fromid":1004488,"thirdappshield":1,"tran":0,"name":"VIP-V5V5","nick":"\u6bcf\u5929\u5b66\u70b9\u5fc3\u7406\u5b66","bkname":"","icon":"","flag":{"govAuthIcon":1,"govCert":1,"passCert":1},"pic":"http:\/\/t2.qlogo.cn\/mbloghead\/abf7f68c807baa7539ac\/50","count":0,"counts":["",""],"timestamp":1333376044},{"id":"90728056065793","content":"\u53c8\u662f\u4e00\u5e74\u300a\u6e05\u660e\u96e8\u4e0a\u300b\u64ad\u653e\u5b63 <a href=\"http:\/\/k.t.qq.com\/k\/%E5%88%86%E4%BA%AB%E9%9F%B3%E4%B9%90\">#\u5206\u4eab\u97f3\u4e50#<\/a> <a href=\"http:\/\/k.t.qq.com\/k\/%E6%B8%85%E6%98%8E%E9%9B%A8%E4%B8%8A-%E8%AE%B8%E5%B5%A9\">#\u6e05\u660e\u96e8\u4e0a-\u8bb8\u5d69#<\/a> <a target=\"_blank\" href=\"http:\/\/url.cn\/1B7OU5\" class=\"ico_music\" shorturl=\"1B7OU5\"  reltitle=\"%E6%B8%85%E6%98%8E%E9%9B%A8%E4%B8%8A-%E8%AE%B8%E5%B5%A9\">http:\/\/url.cn\/1B7OU5<\/a>","sign":"","signSubType":0,"image":[],"music":[{"dwMusicSourceID":"1","dwMusicID":"1191763","sMusicName":"\u6e05\u660e\u96e8\u4e0a","sMusicAuthor":"\u8bb8\u5d69","dwMusicLocation":"2","sMusicUrl":"http:\/\/stream2.qqmusic.qq.com\/13191763.wma"}],"time":"6\u5206\u949f\u524d<i class=\"l\"><\/i>","type":1,"status":0,"from":"<a href=\"http:\/\/1.t.qq.com\/nano.php\" class=\"f\" target=\"_blank\" title=\"\u6765\u81ea\u4f53\u9a8c\u7248\">\u6765\u81ea<em class=\"ico_weibo\"><\/em>\u4f53\u9a8c\u7248<\/a>","fromid":1720,"tran":0,"name":"dream_jet","nick":"\u738b\u68a6\u6770","bkname":"","icon":"","flag":{"govCert":0,"passCert":1},"pic":"http:\/\/t2.qlogo.cn\/mbloghead\/055de29952ad40d82f98\/50","count":0,"counts":["",""],"timestamp":1333375685}],'page':{"page":1,"size":30,"minPage":1,"maxPage":0,"pages":[{"page":1,"id":null,"time":null},{"page":2,"id":"90728056065793","time":1333375685},{"page":3,"id":"1820129178554","time":1333375265},{"page":4,"id":"25321132926689","time":1333374964},{"page":5,"id":"114600090919334","time":1333374605},{"page":6,"id":"50244070332752","time":1333374243},{"page":7,"id":"42297052053565","time":1333373764},{"page":8,"id":"45244076248853","time":1333373345},{"page":9,"id":"27788096589040","time":1333372934}],"next":{"page":2,"id":"90728056065793","time":1333375685}}}}</textarea>
<button onclick="jsonTree.show($('#json')[0].value)">格式化</button>
<button onclick="$('#json')[0].value=jsonTree.getJson()">获取新json</button>
<div class="jsonTree"><ul><li id="jsonTreeWrap"></li></ul></div>
<script src="http://www.qq.com/mb/mat1/mb/js/api/jquery.js"></script>
<script type="text/javascript">
/*
 *Json树
*/
function JsonTree(obj){
    var Self = this;
    Self._body = obj.target;
    Self.data = obj.data;
}
JsonTree.prototype = {
    _body : null,
    data : null, //原始数据
    edit : true, //是否可以编辑json值
    filter : true, //是否可以过滤json项
    show : function(json){ //创建树
        var Self = this;
        try{
            Self.data = (typeof json == 'string' ? eval('(' + json + ')') : json);
        }catch(e){
            Self.data = '';
        }
        Self._body.innerHTML = parseData(Self.data).replace(/<\/li>,/g,',</li>');
        Self.addEvent();
        function parseData(data){
            var dataType = Self.getType(data),
                string = [],
                isArray = dataType == 'Array';
            if (typeof data == 'object') {
                if (data === null) {
                    return '<span class="array">' + 'null' + '</span>';
                }
                for (var i in data) {
                    //console.log(i);
                    string.push((isArray ? '<input type="checkbox" checked class="filter">' : ('<li><input type="checkbox" checked class="filter"><span class="name">"' + i + '"</span>:')) + parseData(data[i]) + '</li>');
                }
                if(string.length) {
                    string = '<ul><li>' + string.join(',</li><li>') + '</li></ul>';
                }
                else {
                    string = '';
                }
                //console.log(string);
                return isArray ? ('<span class="array">[</span>' + string + '<span class="array objectEnd">]</span>') : ('<span class="object">{</span>' + string + '<span class="object objectEnd">}</span>');
            } else if (dataType == 'Number' || dataType == 'Function') {
                return '<span class="number">' + data.toString() + '</span>';
            } else if (dataType == 'Undefined') {
                return '<span class="array">' + 'undefined' + '</span>';
            }
            return '<span class="string">' + (!data ? '""' : ('"' + data.replace(/"/g,'\\"').replace(/</g,'&lt;').replace(/>/g,'&gt;') + '"')) + '</span>';
        }
    },
    addEvent : function(){
        var Self = this;
        $('.filter',Self._body).click(function(){
            console.log(this.checked);
            if (this.checked){
                $('ul',this.parentNode).eq(0).show();
            }
            else {
                $('ul',this.parentNode).eq(0).hide();
            }
        });
    },
    getJson : function(){ //获取Json
        var Self = this,
            clone = Self._body.cloneNode(1);
        $('.filter',clone).each(function(i,o){
            if (!o.checked) $(o).parent().remove();
        });
        $('.objectEnd',clone).each(function(i,o){
            var last = $('li:last',$(o).prev()).prev();
            if (last.length)
            last.get(0).innerHTML = last.text().replace(/,$/g,'');
        });
        //console.log(clone);
        return $(clone).text();
    },
    getType : function(o){ //获取变量类型
        return Object.prototype.toString.call(o).slice(8,-1);
    }
}

//生成实例
var jsonTree = new JsonTree({
    target : $('#jsonTreeWrap')[0]
});
jsonTree.show($('#json')[0].value);
console.log(jsonTree);
</script>
</body>
</html>