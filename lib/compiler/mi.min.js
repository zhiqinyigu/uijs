﻿String.prototype.hasString=function(a){if(typeof a=="object"){for(var b=0,c=a.length;b<c;b++)if(!this.hasString(a[b]))return false;return true}else if(this.indexOf(a)!=-1)return true};window.UI||(UI={ajax:function(a){var b=UI.xmlHttp();b.onreadystatechange=function(){if(b.readyState==4)a.success(b.responseText);else return false};b.open("POST",a.url,true);b.setRequestHeader("Content-type","application/x-www-form-urlencoded");if(UI.isObject(a.data)){var c=[];for(var d in a.data)c.push(d+"="+encodeURIComponent(a.data[d]));a.data=c.join("&")}b.send(a.data)},get:function(a,b,c){var d=UI.xmlHttp();d.onreadystatechange=function(){if(d.readyState==4)c(d.responseText);else return false};if(b!=undefined)if(UI.isObject(b)){var e=[];for(var h in b)e.push(h+"="+encodeURIComponent(b[h]));a+="?"+e.join("&")}else a+="?"+b;d.open("GET",a,true);d.send(null)},xmlHttp:function(){var a;if(window.ActiveXObject)a=new ActiveXObject("Microsoft.XMLHTTP");else if(window.XMLHttpRequest)a=new XMLHttpRequest;return a},cookie:function(a,b,c){if(b==undefined){a=a+"=";b=document.cookie.split(";");for(c=0;c<b.length;c++){for(var d=b[c];d.charAt(0)==" ";)d=d.substring(1,d.length);if(d.indexOf(a)==0)return decodeURIComponent(d.substring(a.length,d.length))}return null}else{d="";if(c){d=new Date;d.setTime(d.getTime()+c*24*60*60*1E3);d="; expires="+d.toGMTString()}document.cookie=a+"="+b+d+"; path=/"}},animate:function(a,b,c,d,e){e=e||0.4;var h=b.hasString("scroll"),k,q=setInterval(function(){var f=h?a[b]:UI.C(a,b),n;if(b=="opacity"){f*=100;c*=100;if(c>100)c=100}else h||(f=f=="auto"?0:Number(f.slice(0,-2)));if(Math.abs(c-f)<3||h&&k==f){f=c;clearInterval(q)}n=k=f+(c-f)*e;if(h)a[b]=parseInt(n);else UI.C(a,b,b!="opacity"?n+"px":n/100+"");if(f==c)if(UI.isString(d))eval(d);else d&&d()},40);return q},getX:function(a){return a.offsetParent?a.offsetLeft+UI.getX(a.offsetParent):a.offsetLeft},getY:function(a){return a.offsetParent?a.offsetTop+UI.getY(a.offsetParent):a.offsetTop},within:function(a,b){var c=UI.getX(b)-UI.scrollX(),d=UI.width(b)+c,e=UI.getY(b)-UI.scrollY();b=UI.height(b)+e;var h={};if(a[0]>c&&a[0]<d&&a[1]>e&&a[1]<b){if(a[0]-c<(d-c)/2)h.left=true;if(a[1]-e<(b-e)/2)h.top=true;return h}},frameX:function(a){return a.frameElement?UI.getX(a.frameElement)+UI.frameX(a.parent):0},frameY:function(a){return a.frameElement?UI.getY(a.frameElement)+UI.frameY(a.parent):0},width:function(a){return parseInt(a.offsetWidth)},height:function(a){return parseInt(a.offsetHeight)},pageWidth:function(){return document.body.scrollWidth||document.documentElement.scrollWidth},pageHeight:function(){return document.body.scrollHeight||document.documentElement.scrollHeight},windowWidth:function(){var a=document.documentElement;return self.innerWidth||a&&a.clientWidth||document.body.clientWidth},windowHeight:function(){var a=document.documentElement;return self.innerHeight||a&&a.clientHeight||document.body.clientHeight},scrollX:function(a){var b=document.documentElement;if(a){var c=a.parentNode,d=a.scrollLeft||0;if(a==b)d=UI.scrollX();return c?d+UI.scrollX(c):d}return self.pageXOffset||b&&b.scrollLeft||document.body.scrollLeft},scrollY:function(a){var b=document.documentElement;if(a){var c=a.parentNode,d=a.scrollTop||0;if(a==b)d=UI.scrollY();return c?d+UI.scrollY(c):d}return self.pageYOffset||b&&b.scrollTop||document.body.scrollTop},scrollTo:function(a,b,c){if(a==document.documentElement||a==document.body)return window.scrollTo(b,c)},hide:function(a){if(!a)return false;if(UI.isString(a))a=this.G(a);var b=this.C(a,"display");if(b!="none")a.__curDisplay=b;a.style.display="none"},show:function(a){if(!a)return false;if(UI.isString(a))a=this.G(a);a.style.display=a.__curDisplay||""},toggle:function(a){if(UI.isString(a))a=this.G(a);this.C(a,"display")=="none"?this.show(a):this.hide(a)},hasClass:function(a,b){if(!a.className)return false;return a.className!=a.className.replace(new RegExp("\\b"+b+"\\b"),"")},addClass:function(a,b){if(a.className)if(this.hasClass(a,b))return false;else a.className+=" "+b;else a.className=b},removeClass:function(a,b){a.className=a.className.replace(new RegExp("\\b"+b+"\\b"),"")},toggleClass:function(a,b){this.hasClass(a,b)?this.removeClass(a,b):this.addClass(a,b)},next:function(a){a=a.nextSibling;if(a==null)return false;return UI.isElement(a)?a:this.next(a)},prev:function(a){a=a.previousSibling;if(a==null)return false;return UI.isElement(a)?a:this.prev(a)},remove:function(a){a&&a.parentNode&&a.parentNode.removeChild(a)},append:function(a,b){b.appendChild(a)},prepend:function(a,b){var c=b.firstChild;c?UI.before(a,c):UI.append(a,b)},after:function(a,b){var c=b.parentNode;c.lastChild==a?c.appendChild(a):c.insertBefore(a,b.nextSibling)},before:function(a,b){b.parentNode.insertBefore(a,b)},replace:function(a,b){b.parentNode.replaceChild(a,b)},tmpl:function(){var a={};return function b(c,d){c=!/\W/.test(c)?(a[c]=a[c]||b(UI.G(c).innerHTML)):UI.tmplString(c);return d?c(d):c}}(),tmplString:function(a){return new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+a.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');")},html:function(a){var b=UI.DC("div"),c=[];b.innerHTML=a;UI.each(b.childNodes,function(d){c.push(d)});return c},text:function a(b){var c=[];b=b.childNodes;for(var d=0,e=b.length;d<e;d++)c.push(b[d].nodeType!=1?b[d].nodeValue:a(b[d]));return c.join("")},parent:function(a,b){if(UI.isArray(a)){var c=[];UI.each(a,function(d){if(b&&UI.hasClass(d.parentNode,b)||!b)c.push(d.parentNode)});return c}return a.parentNode},parents:function(a,b){if(b){var c=[];a=UI.parents(a);UI.each(a,function(d){UI.hasClass(d,b)&&c.push(d)});return c}a=a.parentNode;return a.nodeName=="HTML"?[a]:[a].concat(UI.parents(a))},children:function(a,b){var c=[];if(b)b=b.split("|");UI.each(a.childNodes,function(d){var e=false;if(b)for(var h=0,k=b.length;h<k;h++)if(UI.hasClass(d,b[h])){e=true;break}if(UI.isElement(d)&&(!b||e))c.push(d)});return c},A:function(a,b,c){if(c==undefined)return a.getAttribute(b);else c==""?a.removeAttribute(b):a.setAttribute(b,c)},C:function(a,b,c){if(c==undefined)if(a.currentStyle){if(b=="opacity")return a.style.filter.indexOf("opacity=")>=0?parseFloat(a.style.filter.match(/opacity=([^)]*)/)[1])/100:"1";return a.currentStyle[b]}else{if(window.getComputedStyle){b=b.replace(/([A-Z])/g,"-$1");b=b.toLowerCase();return window.getComputedStyle(a,null).getPropertyValue(b)}}else if(b=="opacity"&&UI.B.ie)a.style.filter=(a.filter||"").replace(/alpha\([^)]*\)/,"")+"alpha(opacity="+c*100+")";else a.style[b]=c},DC:function(a){return document.createElement(a)},E:function(a){if(a&&a.clone)return a;a=window.event||a;return{clone:true,stop:function(){if(a&&a.stopPropagation)a.stopPropagation();else a.cancelBubble=true},prevent:function(){if(a&&a.preventDefault)a.preventDefault();else a.returnValue=false},target:a.target||a.srcElement,x:a.clientX||a.pageX,y:a.clientY||a.pageY,button:a.button,key:a.keyCode,shift:a.shiftKey,alt:a.altKey,ctrl:a.ctrlKey,type:a.type,wheel:a.wheelDelta/120||-a.detail/3}},EA:function(a,b,c,d){if(UI.isString(a)){var e=c;c=function(){eval(e)}}if(a.addEventListener){if(b=="mousewheel")b="DOMMouseScroll";a.addEventListener(b,c,d);return true}else return a.attachEvent?a.attachEvent("on"+b,c):false},ER:function(a,b,c){if(a.removeEventListener){a.removeEventListener(b,c,false);return true}else return a.detachEvent?a.detachEvent("on"+b,c):false},G:function(a){return document.getElementById(a)},GT:function(a,b){return a.getElementsByTagName(b)},GC:function(){function a(g,j){if(!j){j=g;g=document}g=g||document;if(!/^[\w\-_#]+$/.test(j)&&g.querySelectorAll)return b(g.querySelectorAll(j));if(j.indexOf(",")>-1){j=j.split(/,/g);for(var l=[],i=0,p=j.length;i<p;++i)l=l.concat(a(j[i],g));return n(l)}j=j.match(e);var m=j.pop();l=(m.match(k)||f)[1];i=!l&&(m.match(h)||f)[1];p=m.split(".").slice(2);m=!l&&(m.match(q)||f)[1];if(i&&!m&&g.getElementsByClassName)m=b(g.getElementsByClassName(i));else{m=!l&&b(g.getElementsByTagName(m||"*"));if(i)m=d(m,"className",RegExp("(^|\\s)"+i+"(\\s|$)"),p);if(l)return(g=g.getElementById(l))?[g]:[]}return j[0]&&m[0]?c(j,m):m}function b(g){try{return Array.prototype.slice.call(g)}catch(j){for(var l=[],i=0,p=g.length;i<p;++i)l[i]=g[i];return l}}function c(g,j,l){var i=g.pop();if(i===">")return c(g,j,true);var p=[],m=-1,o=(i.match(k)||f)[1],r=!o&&(i.match(h)||f)[1];i=!o&&(i.match(q)||f)[1];var v=-1,u,s,t;for(i=i&&i.toLowerCase();u=j[++v];){s=u.parentNode;do{t=(t=(t=!i||i==="*"||i===s.nodeName.toLowerCase())&&(!o||s.id===o))&&(!r||RegExp("(^|\\s)"+r+"(\\s|$)").test(s.className));if(l||t)break}while(s=s.parentNode);if(t)p[++m]=u}return g[0]&&p[0]?c(g,p):p}function d(g,j,l,i){var p=-1,m,o=-1,r=[];for(i=i||"";m=g[++p];)if(l.test(m[j])&&m[j].hasString(i))r[++o]=m;return r}var e=/(?:[\w\-\\.#]+)+(?:\[\w+?=([\'"])?(?:\\\1|.)+?\1\])?|\*|>/ig,h=/^(?:[\w\-_]+)?\.([\w\-_]+)/,k=/^(?:[\w\-_]+)?#([\w\-_]+)/,q=/^([\w\*\-_]+)/,f=[null,null],n=function(){var g=+new Date,j=function(){var l=1;return function(i){var p=i[g],m=l++;if(!p){i[g]=m;return true}return false}}();return function(l){for(var i=l.length,p=[],m=-1,o=0,r;o<i;++o){r=l[o];if(j(r))p[++m]=r}g+=1;return p}}();return a}(),isObject:function(a){return typeof a=="object"},isElement:function(a){return a&&a.nodeType==1},isUndefined:function(a){return typeof a=="undefined"},isFunction:function(a){return this.getType(a)=="Function"},isNumber:function(a){return this.getType(a)=="Number"},isString:function(a){return this.getType(a)=="String"},isArray:function(a){return this.getType(a)=="Array"},getType:function(a){return Object.prototype.toString.call(a).slice(8,-1)},trim:function(a){return a.replace(/^\s+|\s+$/g,"")},has:function(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]==b)return true;return false},each:function(a,b){if(UI.isUndefined(a[0]))for(var c in a)UI.isFunction(a[c])||b(c,a[c]);else{c=0;for(var d=a.length;c<d;c++)UI.isFunction(a[c])||b(a[c],c)}},merge:function(a,b){var c=[];if(b){UI.each(b,function(d){UI.has(a,d)||c.push(d)});return a.concat(c)}else{UI.each(a,function(d){UI.has(c,d)||c.push(d)});return c}},ready:function(a){if(UI.ready.done)return a();if(UI.ready.timer)UI.ready.ready.push(a);else{UI.ready.ready=[a];UI.ready.timer=setInterval(UI.isReady,13)}},isReady:function(){if(UI.ready.done)return false;if(document&&document.getElementsByTagName&&document.getElementById&&document.body){clearInterval(UI.ready.timer);UI.ready.timer=null;for(var a=0;a<UI.ready.ready.length;a++)UI.ready.ready[a]();UI.ready.ready=null;UI.ready.done=true}},B:function(){var a={},b=navigator.userAgent;a.ie6=b.hasString("MSIE 6")&&!b.hasString("MSIE 7")&&!b.hasString("MSIE 8");a.ie=b.hasString("MSIE");return a}()});UI.B.ie&&document.execCommand("BackgroundImageCache",false,true);String.prototype.toTitle=function(){return this.replace(/\r/g,"").replace(/\n/g,"").replace(/\'/g,"&#39;").replace(/\"/g,"&#34;").replace(/</g,"&#60;").replace(/>/g,"&#62;")};(function(){var V1="talk[i].source",V2="info.source",V3='<div class="SA"><em>◆</em><span>◆</span></div>',V4='%><b class="vip"></b><%',V5=' href="javascript:void(0)"',V6=' onerror="MI.Pic(this, 50)"',V7=' title="<%=talk[i].nick.toTitle()%>(@<%=talk[i].name%>)"',V8=V5+' onclick="if(confirm(MI.tips.del))MI.talkList.remove(';MI={string:{length:function(a){var b=a.match(/[^\x00-\x80]/g);return a.length+(b?b.length:0)},escape:function(a){return a.replace(/'/g,"\\'").replace(/</g,"&lt;").replace(/>/g,"&gt;")}},number:{format:function(a){return(a+"").replace(/(?=(?!\b)(?:\w{3})+$)/g,",")}},random:function(){return(new Date).getTime()},tips:{del:"是否删除该内容？"},delay:{},validate:{},tmpl:{list:'<li id="<%=info.id%>"><div class="userPic"><a href="/<%=info.account%>" title="(<%=info.nick.toTitle()%>@<%=info.account%>)"<%if('+V2+'.type==2){%> class="masPic"<%}%>><img src="<%=info.userPic%>"'+V6+"/></a><%if("+V2+".type==2){%><%="+V2+'.cusPic%><%}%></div><div class="msgBox"><div class="userName"><a href="<%=info.account%>" title="(<%=info.nick.toTitle()%>@<%=info.account%>)"><strong><%=info.nick%></strong></a><%if(info.vip){ '+V4+'}%> <%=info.action%></div><div class="msgCnt"><%=info.content%></div><%if('+V2+'.type==1){%><div class="replyBox"><%='+V2+'.content%></div><%}%><div class="pubInfo"><span class="left"><%=info.time%> 发自<%=info.sorurce%> <%if('+V2+'.type==2){%><a class="view zfNum"'+V5+'>查看对话</a></b><%}%></span><p class="funBox"><a'+V8+'\'<%=info.id%>\',this)" class="del">删除</a></p></div><%if('+V2+'.type==2){%><div class="talkDetail"><%='+V2+".nick%>: <%="+V2+".content%></div><%}%></div></li>",listAll:'<%for(var i=0,n=talk.length;i<n;i++){%><li id="<%=talk[i].id%>" rel="<%=talk[i].timestamp%>"><%if(!guest){%><%if('+V1+' && talk[i].type==4){%><div class="userPic"><a href="/<%=talk[i].name%>"'+V7+' class="masPic"><img src="<%=talk[i].pic%>"'+V6+'/></a><a href="/<%='+V1+'.name%>" title="<%='+V1+".nick.toTitle()%>(@<%="+V1+'.name%>)" class="cusPic"><img src="<%='+V1+'.pic%>"'+V6+'/></a></div><%}else{%><div class="userPic"><a href="/<%=talk[i].name%>"'+V7+'><img src="<%=talk[i].pic%>"'+V6+'/></a></div><%}%><%}%><div class="msgBox"><div class="userName" rel="<%=talk[i].name%>"><a href="/<%=talk[i].name%>"'+V7+"><strong><%=talk[i].nick%></strong></a><%if(talk[i].vip){ "+V4+" }%> <%if("+V1+" && talk[i].type==2){%>转播<%}else if("+V1+' && talk[i].type==4){%>回复<a href="/<%='+V1+'.name%>" title="<%='+V1+".nick.toTitle()%>(@<%="+V1+'.name%>)"><%='+V1+".nick%></a><%if ("+V1+".vip){"+V4+' }%>:<%}%></div><div class="msgCnt"><%=talk[i].content%></div><%if('+V1+' && talk[i].type==2){%><div class="replyBox">'+V3+'<div class="userPic"><a href="/<%='+V1+'.name%>" title="<%='+V1+".nick.toTitle()%>(@<%="+V1+'.name%>)"><img src="<%='+V1+'.pic%>"'+V6+'/></a></div><div class="msgBox"><div class="msgCnt"><a href="/<%='+V1+'.name%>" title="<%='+V1+".nick.toTitle()%>(@<%="+V1+'.name%>)"><strong><%='+V1+".nick%></a><%if("+V1+".vip){"+V4+"}%></strong>: <%="+V1+'.content%></div><div class="pubInfo"><span class="left"><%='+V1+".time%> 发自<%="+V1+'.from%> <a class="zfNum" href="/t/<%=talk[i].id%>"><strong class="relayNum"><%='+V1+'.count%></strong>人转播</a></span></div></div></div><%}%><div class="pubInfo"><span class="left"><%=talk[i].time%> 发自<%=talk[i].from%><%if('+V1+" && "+V1+".content && "+V1+'.content.length && talk[i].type==4){%> <a class="view zfNum"'+V5+'>查看对话</a><%}%></span><p class="funBox"><%if(MI.user){if(!guest && MI.user.account==talk[i].name){%><a class="del"'+V8+'<%=talk[i].id%>,this)">删除</a><%}else{%><a'+V5+' class="report">举报</a><a class="reply talk"'+V5+'>回复</a><a class="relay zf"'+V5+">转播</a><%}%><%}%></p></div><%if("+V1+' && talk[i].type==4){%><div class="talkDetail"><%='+V1+".nick%>: <%="+V1+".content%></div><%}%></div></li><%}%>",msg:'<li id="<%=info.id%>"><div class="msgBox"><div class="userName"><a href="/<%=info.account%>"><%=info.nick%></a><%if(info.vip){ '+V4+'}%></div><div class="msgCnt"><%=info.content%></div><div class="pubTime"><%=info.time%></div></div><p class="btnBox"><a class="btn"'+V8+'<%=info.id%>,this)">删除</a></p></li>',reply:'<div class="talkWrap">'+V3+'<div class="top"><span class="left replyTitle"></span><a'+V5+' class="close" title="关闭">关闭</a></div><div><textarea class="inputTxt"></textarea></div><div class="bot"><input type="button" class="inputBtn sendBtn" value="" /><span class="countTxt"></span></div></div>'},selectTxt:function(a,b,c){if(document.createRange)a.setSelectionRange(b,c);else{a=a.createTextRange();a.collapse(true);a.moveStart("character",b);a.moveEnd("character",c-b);a.select()}},countNum:function(a,b,c){if(!a)return false;var d=a.innerHTML||0;a.innerHTML=c?MI.number.format(parseInt(d.replace(/,/g,""))+b):parseInt(d)+b},fC:{numFormat:[],num:[]},follow:function(a,b,c){if(!MI.fC.init){MI.fC.numFormat=UI.GC(".followNumFormat");MI.fC.num=UI.GC(".followNum");MI.fC.init=1}if(!b.sending){var d=-1,e;e=b.className;var h=UI.G("followedNum_"+a),k=UI.G("followNum_"+a),q=e!="addAttention"&&e!="delAttention";if(e=="addAttention"||q){d=1;e="/follow.php"}else e="/unfollow.php";b.sending=true;UI.get(e,"u="+a+"&r="+MI.random(),function(f){b.sending=false;f=eval("("+f+")");if(f.result==0){if(!q)b.className=d==1?"delAttention":"addAttention";h&&MI.countNum(h,d);k&&MI.countNum(k,d);f=0;for(var n=MI.fC.numFormat.length;f<n;f++)MI.countNum(MI.fC.numFormat[f],d,true);f=0;for(n=MI.fC.num.length;f<n;f++)UI.A(MI.fC.num[f],"rel")==a&&MI.countNum(MI.fC.num[f],d);c&&c()}else alert(f.msg)})}},topic:function(a,b,c){if(!b.sending){var d=c||UI.hasClass(b,"btnCancel"),e=d?"2":"1";UI.get("/asyn/topic.php","r="+MI.random()+"&tid="+a+"&type="+e,function(h){h=eval("("+h+")");if(h.result==0)if(c){var k=b.parentNode;UI.animate(k,"opacity",0,function(){UI.remove(k)})}else b.className=d?"inputBtn btnAdd":"inputBtn btnCancel";else alert(h.msg);b.sending=false})}b.sending=true},topicDel:function(a,b){MI.topic(a,b,true)},addHover:function(a){a.onmouseover=function(){var b=this;setTimeout(function(){UI.addClass(b,"hover")},0)};a.onmouseout=function(){var b=this;setTimeout(function(){UI.removeClass(b,"hover")},0)}}};MI.TalkBox=function(a){if(this._body=UI.isString(a)?UI.G(a):a){var b=this;b._txt=b.$("textarea")||b.$(".inputTxt");b._tip=b.$(".countTxt");b._btn=b.$(".sendBtn");b._topic=b.$(".creatNew");b._video=b.$(".newVideo");b._pic=b.$(".insertPic");b._close=b.$(".close");b._num=[UI.G("talkNum")];UI.ready(function(){setTimeout(function(){b._txt.blur()},0);b._txt.onkeydown=function(c){if(!b.sending){b.countTxt();c=UI.E(c);if(c.ctrl&&c.key==13){b.sending=true;b.countTxt();b.send()}}};b._txt.onkeyup=function(){b.sending||b.countTxt()};b._txt.onfocus=function(){UI.hide(UI.prev(this));this.focused=true};b._txt.onblur=function(){b._txt.value==0&&UI.show(UI.prev(this));this.focused=false};if(b._topic)b._topic.onclick=function(){b.addTopic()};b._btn.onfocus=function(){this.blur()};b._btn.onclick=function(){b.countTxt();b.send()};if(b._close)b._close.onclick=function(){b.hide()}})}};MI.TalkBox.prototype={delay:{},url:"/publish.php",type:null,talkId:null,txtMax:140,txtTopic:"#请在这里输入自定义话题#",addList:0,addNum:1,autoHeight:0,tmpl:MI.tmpl.list,countTxt:function(){var a=this,b,c=Math.ceil(MI.string.length(UI.trim(a._txt.value).replace(new RegExp(a.txtTopic,"g"),""))/2);if(c>this.txtMax){b='超出<em class="error">';UI.addClass(a._btn,"disabled")}else{b="还能输入<em>";UI.removeClass(a._btn,"disabled")}c==0&&UI.addClass(a._btn,"disabled");a.showTip(b+Math.abs(a.txtMax-c)+"</em>字");if(a._msgTo&&(a._msgTo.value==""||a._msgTo.error))UI.addClass(a._btn,"disabled");c<=a.txtMax&&a.type==1&&UI.removeClass(a._btn,"disabled")},showTip:function(a){this._tip.innerHTML=a},hide:function(){UI.remove(this._body);this.hideCall&&this.hideCall()},hideCall:null,successCall:null,send:function(){var a=this,b;if(UI.hasClass(a._btn,"disabled")){UI.trim(a._txt.value).length&&a._txt.focus();a._msgTo&&UI.trim(a._msgTo).value==""&&a._msgTo.focus();return false}UI.addClass(a._btn,"disabled");a.delay.tip=setTimeout(function(){a.showTip("发送中")},500);b={content:a._txt.value.replace(new RegExp(a.txtTopic,"g"),"")};if(a.type){b.pId=a.talkId;b.type=a.type}if(a._msgTo)b.account=a._msgTo.value;UI.ajax({url:a.url,data:b,success:function(c){c=eval("("+c+")");if(MI.user&&c.info){c.info.userPic=MI.user.pic;c.info.nick=c.info.nick||MI.user.name;c.info.account=c.info.account||MI.user.account;c.info.vip=c.info.vip||MI.user.vip}clearTimeout(a.delay.tip);a.showTip("<span"+(c.result<0?' class="error"':"")+">"+c.msg+"</span>");a.delay.tip=setTimeout(function(){UI.animate(a._tip,"opacity",0,function(){if(c.result==0)a._txt.value="";a._txt.focus();a.countTxt();UI.C(a._tip,"opacity","");a._tip.style.filter="";a.sending=false;a.successCall&&c.result==0&&a.successCall();if(a.addList&&c.result==0){c.info.source={};if(a.type){c.info.action=a.action;c.info.source=a.source}MI.talkList._tip&&UI.hide(MI.talkList._tip);var d=UI.html((new UI.tmplString(a.tmpl))(c))[0],e=UI.GC(d,".relayNum")[0];if(e){var h=e.parentNode;MI.countNum(e,1);if(h.nodeName=="A")h.href="/t/"+c.info.id}MI.talkList.addEvent(d);UI.C(d,"opacity",0);UI.prepend(d,MI.talkList._body);UI.scrollY()>UI.getY(MI.talkList._body)&&setTimeout(function(){UI.scrollTo(document.documentElement,0,UI.scrollY()+UI.height(d))},0);UI.animate(d,"opacity",1,function(){UI.C(d,"filter","")},0.2)}c.result==0&&a.countNum(1)})},1E3)}});return false},countNum:function(a){if(a>0&&!this.addNum)return false;if(this._num.length)for(var b=0,c=this._num.length;b<c;b++)MI.countNum(this._num[b],a)},addTopic:function(){this._txt.focus();var a=this._txt.value;if(!a.hasString(this.txtTopic))this._txt.value=a+=this.txtTopic;a=a.indexOf(this.txtTopic);if(a==-1)a=0;MI.selectTxt(this._txt,a+1,this.txtTopic.length+a-1);this._txt.scrollTop=999;this.countTxt()},$:function(a){return UI.GC(this._body,a)[0]}};MI.MsgBox=function(a){function b(){c.countTxt()}var c=new MI.TalkBox(a);c._msgTo=c.$(".msgTo");c._num=UI.GC(".msgNum");c.url="/messages/send.php";UI.EA(c._msgTo,"keyup",b);UI.EA(c._msgTo,"keydown",b);UI.EA(c._msgTo,"blur",b);return c};MI.MsgList=function(a){return new MI.TalkList(a)};MI.TalkList=function(a){var b=this;b._body=UI.G(a);b._more=b._bottom=UI.GC(UI.G("moreList"),"a")[0];b._new=UI.G("talkNew");b._list=UI.children(b._body);a=(new UI.tmplString(MI.tmpl.reply))({});b._talk=UI.html(a)[0];b._relay=UI.html(a.replace(/<\/textarea>/g,"").replace(/textarea/g,"input"))[0];b.replyBox=new MI.TalkBox(b._talk);b.relayBox=new MI.TalkBox(b._relay);b.replyBox.autoHeight=1;b.replyBox.hideCall=b.relayBox.hideCall=function(){UI.removeClass(UI.G(b.current),"cur")};b.replyBox.successCall=b.relayBox.successCall=function(){b.talkBox.hide();b.talkBox.display=0;if(b._relayNum){MI.countNum(b._relayNum,1);b._relayNum=null}};UI.EA(b.replyBox._close,"click",function(){b.replyHide()});UI.EA(b.relayBox._close,"click",function(){b.replyHide()});b.cacheLast();if(b._more){b._more.onclick=function(d){b.more();UI.E(d).prevent()};b._more.onfocus=function(){this.blur()}}UI.ready(function(){b.bottom()});a=0;for(var c=b._list.length;a<c;a++)b.addEvent(b._list[a])};MI.TalkList.prototype={cur:null,_tip:null,removeUrl:"/delete.php",last:{},remove:function(a){a=String(a);var b=this,c=UI.G(a);if(!c.sending){UI.get(b.removeUrl,{id:a,r:MI.random()},function(d){c.sending=false;d=eval("("+d+")");if(d.result==0){MI.talkBox&&MI.talkBox.countNum(-1);UI.animate(c,"opacity",0,function(){UI.remove(c);b.tip&&UI.children(b._body);b.bottom()})}else alert(d.msg)});c.sending=true}},reply:function(a,b){if(this.talkBox&&this.current&&this.current!=a&&this.talkBox.display){this.talkBox.hide();this.talkBox.display=0}this.talkBox=b?this.relayBox:this.replyBox;this._talk=this.talkBox._body;if(this.talkBox.display){this.talkBox.hide();this.replyHide()}else{var c=UI.G(a),d=this.current,e=UI.GC(c,".userName strong")[0].innerHTML,h=UI.GC(c,".userName .vip").length,k=UI.GC(c,".userName a")[0].href,q=UI.GC(c,".msgCnt")[0],f=UI.text(q);q=q.innerHTML;var n=UI.GC(c,".replyBox")[0],g=UI.GC(c,".replyBox .msgCnt")[0],j=UI.GC(c,".userPic")[0];if(g)f=UI.text(g);n||(f=e+": "+f);d&&UI.removeClass(UI.G(d),"cur");UI.addClass(c,"cur");this._relayNum=b?UI.GC(c,".relayNum")[0]:null;this.talkBox._body.className=b?"zfWrap":"talkWrap";UI.GC(this._talk,".replyTitle")[0].innerHTML=b?'转播 "'+MI.string.escape(f.slice(0,30))+(f.length>30?"...":"")+'"<br/>再点评两句:':"回复 "+e+":";this.talkBox.talkId=a;this.talkBox.type=b?1:2;this.talkBox.action=b?"转播":'回复<a href="'+k+'">'+e+"</a>"+(h?'<b class="vip"></b>':"")+":";if(b&&!n){var l=c.cloneNode(true);d=UI.GC(l,".msgCnt")[0];UI.remove(UI.GC(l,".zfWrap")[0]);UI.remove(UI.GC(l,".talkWrap")[0]);UI.remove(UI.GC(l,".funBox")[0]);UI.C(UI.GC(l,".userName")[0],"display","inline");UI.C(d,"display","inline");d.innerHTML=": "+d.innerHTML}this.talkBox.source={type:b?1:2,content:b?n?n.innerHTML:'<div class="SA"><em>◆</em><span>◆</span></div>'+l.innerHTML:q,nick:e,cusPic:j&&j.innerHTML.replace(/cusPic/gi,"hide").replace(/<a/i,'<a class="cusPic"')||0};this.talkBox._txt.value="";this.talkBox.countTxt();UI.append(this._talk,UI.GC(c,".msgBox")[0]);this.talkBox._txt.focus();this.current=a;this.talkBox.display=1}if(b){this.replyBox.hide();this.replyBox.display=0}else{this.relayBox.hide();this.relayBox.display=0}if(this.replyBox.display||this.relayBox.display){UI.addClass(UI.G(this.current),"cur");UI.addClass(UI.G(this.current),"hover")}},replyHide:function(){UI.removeClass(UI.G(this.current),"cur");UI.removeClass(UI.G(this.current),"hover");this.talkBox.display=0},relay:function(a){this.reply(a,"relay")},report:function(a){var b=UI.A(UI.GC(UI.G(a),".userName")[0],"rel");jubao_msg(a,b)},fav:function(){},addEvent:function(a){var b=this,c=UI.GC(a,".view")[0],d=UI.GC(a,".report")[0],e=UI.GC(a,".talkDetail")[0],h=UI.GC(a,".msgCnt")[0],k=UI.GC(a,".reply")[0],q=UI.GC(a,".relay")[0],f=UI.GC(a,".replyMsg")[0];MI.addHover(a);if(k)k.onclick=function(){b.reply(a.id)};if(q)q.onclick=function(){b.relay(a.id)};if(c){c.onmouseover=function(){UI.C(e,"display","block")};c.onmouseout=function(){UI.hide(e)}}h&&h.innerHTML==""&&UI.hide(h);if(d)d.onclick=function(){b.report(a.id)};if(f)f.onclick=function(){MI.talkBox._msgTo.value=UI.A(this,"rel");MI.talkBox._msgTo.focus();MI.talkBox._txt.select()}},cacheLast:function(){var a=UI.children(this._body);if(a=a[a.length-1])this.last={id:a.id,time:UI.A(a,"rel")}},bottom:function(){var a=this._bottom.parentNode.parentNode,b=UI.next(a);if(b){UI.C(this._body,"marginBottom",0);a=UI.height(a)-UI.height(b);UI.C(this._body,"marginBottom",a<0?-a+"px":"")}},more:function(){var a=this;UI.children(a._body);var b="r="+MI.random()+"&time="+a.last.time+"&id="+a.last.id+(a.guest?"&u="+a.guest:"");if(!a._more.sending){UI.addClass(a._more,"loading");UI.get(UI.A(a._more,"rel"),b,function(c){c=eval("("+c+")");if(c.result==0){c.info.guest=a.guest;for(var d=document.createDocumentFragment(),e=UI.html((new UI.tmplString(MI.tmpl.listAll))(c.info)),h=0,k=e.length;h<k;h++){a.addEvent(e[h]);UI.append(e[h],d)}UI.append(d,a._body);UI.C(a._body,"marginBottom","");c.info.hasNext==0?UI.addClass(a._more.parentNode,"hide"):a.cacheLast()}else alert(c.msg);UI.removeClass(a._more,"loading");a._more.sending=false})}a._more.sending=true},newTalk:function(){}};MI.Talk=function(a){var b=this,c=(new UI.tmplString(MI.tmpl.reply))({});b.id=a;b._body=UI.G(a);b._talk=UI.html(c)[0];b._relay=UI.html(c.replace(/<\/textarea>/g,"").replace(/textarea/g,"input"))[0];b._relayNum=UI.G("relay"+a);b.replyBox=new MI.TalkBox(b._talk);b.relayBox=new MI.TalkBox(b._relay);b.replyBox.successCall=function(){MI.dialog.hide()};b.relayBox.successCall=function(){MI.dialog.hide();b._relayNum&&MI.countNum(b._relayNum,1)};b.replyBox.talkId=this.relayBox.talkId=a;a=UI.GC(b._body,".userDetail a")[1];b.name=UI.text(a);b.account=UI.A(a,"rel");b.content=UI.text(UI.GC(b._body,".msgCnt")[0]);a=UI.GC(b._body,".report")[0];c=UI.GC(b._body,".reply")[0];var d=UI.GC(b._body,".relay"),e=d[0];d=d[1];if(c)c.onclick=function(){b.reply()};if(e)e.onclick=function(){b.reply(1)};if(d)d.onclick=function(){b.reply(1)};if(a)a.onclick=function(){b.report()}};MI.Talk.prototype={reply:function(a){var b=this;b.talkBox=a?b.relayBox:b.replyBox;UI.GC(b.talkBox._body,".replyTitle")[0].innerHTML=a?'转播 "'+UI.trim(b.name)+": "+b.content.slice(0,12)+(b.content.length>12?"...":"")+'"<br/>再点评两句:':"回复 "+b.name+":";b.talkBox._body.className=a?"zfWrap":"talkWrap";b.talkBox.type=a?1:2;b.talkBox._txt.value="";b.talkBox.countTxt();MI.dialog.show({width:462,html:this.talkBox._body});setTimeout(function(){b.talkBox._txt.focus()},0)},report:function(){jubao_msg(this.id,this.account)}};MI.Validate=function(a){function b(f){var n,g,j,l,i=0,p=0,m={};if(UI.isString(f)){f=f;p=1}else{n=UI.E(f);f=UI.A(n.target,"name")}g=c.data.inputs[f];k=g.target;j=k.value;if(g.removed)return false;if(g.replace){l=g.replace(j);if(j!=l)k.value=l}if(p?1:k.blured)if(i=g.rule?g.rule(k.value):0){c.showMessage(g,i);k.error=1;c.success=0}else if(!g.url||g.url&&k.focused){c.hideMessage(g);k.error=0}m[f]=j;!p&&!i&&g.url&&k.blured&&n.type=="blur"&&UI.get(g.url,m,function(o){o=eval("("+o+")");if(o.result==0)c.hideMessage(g);else{c.showMessage(g,o.msg);c.success=0}})}this.data=a;this.check=a.check;this.isAjax=a.isAjax==undefined?1:a.isAjax;this._body=UI.G(a.id);var c=this,d,e=0,h,k;if(UI.isFunction(a.messages))d=true;for(var q in c.data.inputs){h=c.data.inputs[q];k=h.target=UI.G(q);if(d)h.message=a.messages(a.inputs[q].target);else{h.message=a.messages[e];e++}UI.A(h.message,"rel",h.message.innerHTML||"");h.ico=UI.html('<b class="pass" style="display:none"></b>')[0];UI.after(h.ico,h.target);k.onfocus=function(){this.ico=false;this.focused=true};k.onblur=function(){this.ico=this.blured=true;this.focused=false};UI.EA(k,"blur",b);UI.EA(k,"keyup",b)}UI.EA(c._body,"submit",function(f){var n=UI.E(f);f={};c.success=1;c.isAjax&&n.prevent();if(c.check&&c.check())return false;for(var g in c.data.inputs)b(g);if(c.success&&c.isAjax){for(g in c.data.inputs){n=UI.G(g);if(n.type=="radio"){n=UI.GC(n.parentNode,"input[type=radio]");for(var j=0,l=n.length;j<l;j++)if(n[j].checked){f[g]=n[j].value;break}}else f[g]=UI.G(g).value}UI.ajax({url:UI.A(c._body,"action"),data:f,success:function(i){i=eval("("+i+")");var p=0,m=1,o;if(i.result==0){if(i.info)for(var r in c.data.inputs){o=c.data.inputs[r];if(i.info[p].result==0){if(!o.removed){o.success?c.showMessage(o,o.success,true):c.hideMessage(o);if(o.remove){UI.A(o.target,"disabled","disabled");o.removed=true}}}else{c.showMessage(o,i.info[p].msg);m=0}p++}m&&c.data.success&&c.data.success()}else alert(i.msg)}})}else c.success||n.prevent()})};MI.Validate.prototype={showMessage:function(a,b,c){b||(b=UI.A(a.message,"rel"));a.message.innerHTML=b;UI.addClass(a.message,c?"success":"error");!a.noIco&&c?UI.show(a.ico):UI.hide(a.ico)},hideMessage:function(a){a.message.innerHTML=UI.A(a.message,"rel");UI.removeClass(a.message,"error");UI.removeClass(a.message,"success");!a.noIco&&a.target.ico&&UI.show(a.ico)}};MI.RelateSelect=function(a){var b=this,c,d,e;b._body=UI.G(a.id);c=UI.GT(b._body,"select");b._first=c[0];b._second=c[1];b.data={};b._first.innerHTML=b._second.innerHTML="";for(var h in a.data){c=UI.DC("option");e=h.split(",");c.innerHTML=e[0];c.value=e[1];UI.append(c,this._first);b.data[e[1]]=a.data[h];d||(d=e[1])}b.show(d);b._first.onchange=function(){b.show(this.value)}};MI.RelateSelect.prototype={show:function(a){var b,c;this._second.innerHTML="";for(var d=0,e=this.data[a].length;d<e;d++){b=UI.DC("option");c=this.data[a][d].split(",");b.innerHTML=c[0];b.value=c[1];UI.append(b,this._second)}}};MI.Dialog=function(){var a=this;a._body=UI.DC("div");a._body.className="D";a._body.innerHTML='<div class="bg"></div><div class="CR"><div class="top"><span class="left"><em></em></span><span class="right"><em></em></span></div><div class="DTitle"></div><a href="javascript:void(0)" class="DClose" title="关闭">关闭</a><div class="DCont"></div><div class="bot"><span class="left"><em></em></span><span class="right"><em></em></span></div></div>';a._bg=a.$(".bg");a._wrap=a.$(".CR");a._title=a.$(".DTitle");a._close=a.$(".DClose");a._cont=a.$(".DCont");a.key=function(b){switch(UI.E(b).key){case 27:a.hide();break}};a.resizeBg=function(){if(a.display){if(UI.B.ie)a._bg.style.cssText+=";width:100%;";a.delay=setTimeout(function(){var b=UI.pageHeight(),c=UI.windowHeight();a._bg.style.cssText+=";margin-left:0;width:"+UI.pageWidth()+"px;height:"+(b<c?c:b)+"px;"},0)}};UI.EA(document,"keyup",a.key);UI.EA(window,"resize",a.resizeBg);a._close.onclick=function(){a.hide()}};MI.Dialog.prototype={width:462,close:1,show:function(a){var b=this;if(!b._append){document.body.appendChild(b._body);b._append=true;UI.C(b._bg,"marginLeft","-9999px")}b.close=a.close!=undefined?a.close:1;b.close?UI.show(b._close):UI.hide(b._close);b._title.innerHTML=a.title||"";UI.C(b._title,"height",a.title?"":"0");if(UI.isString(a.html))b._cont.innerHTML=a.html;else if(UI.isObject(a.html)){for(var c=0,d=b._cont.childNodes.length;c<d;c++)UI.remove(b._cont.childNodes[0]);UI.append(a.html,b._cont);UI.show(a.html)}if(a.width)b.width=a.width;UI.C(b._wrap,"width",b.width+"px");UI.C(b._wrap,"opacity",0);UI.show(b._body);setTimeout(function(){b.resizeBg();b._wrap.style.cssText="width:"+b.width+"px;margin:"+(UI.scrollY()-UI.height(b._wrap)/2)+"px 0 0 -"+b.width/2+"px;"},0);a.start&&a.start();b.end=a.end?a.end:null;b.display=true},hide:function(){UI.hide(this._body);this.end&&this.end();this.display=false},$:function(a){return UI.GC(this._body,a)[0]}};MI.Pic=function(a,b){a.src="http://mat1.gtimg.com/www/mb/images/head_"+b+".jpg"}})();function jubao(a){var b="http://jubao.qq.com/cgi-bin/jubao?";if(a!="")b+=a;a=UI.html('<div style="width:620px;height:436px;overflow:hidden;border:solid #FFF;border-width:5px 0 10px"></div>')[0];var c=document.createElement("iframe");c.frameborder="0";c.scrolling="no";c.style.cssText="width:628px;height:470px;background:#FFF;margin:-13px 0 0 -5px;-margin-top:-32px;border-style:none";a.appendChild(c);MI.dialog.show({title:"腾讯举报平台",width:670,html:a});c.src=b}try{document.domain="qq.com"}catch(e$$9){}function jubao_onClose(){MI.dialog.hide()}function jubao_msg(a){jubao("appname=micoblog&subapp=web&jubaotype=msg&tw_msg_id="+a+"&tw_name=&tw_vip=&envname=web")}function jubao_user(a){jubao("appname=micoblog&subapp=web&jubaotype=uin&tw_pic_url=&tw_name="+a+"&tw_vip=&envname=web")}MI.dialog=new MI.Dialog;